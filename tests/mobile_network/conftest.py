#!/usr/bin/env python
# -*- coding: utf-8 -*-
from __future__ import print_function, absolute_import, division

import pytest
from pytest import fixture
from shapely.geometry import Point, LineString, shape, mapping
import os
from collections import OrderedDict
from digital_comms.mobile_network.model import NetworkManager
from digital_comms.mobile_network.system_simulator import SimulationManager

@pytest.fixture
def rootdir():
    return os.path.dirname(os.path.abspath(__file__))

@fixture(scope='function')
def setup_postcode_sector():
    return {
        'type': 'Feature', 'id': '1045',
        'properties': OrderedDict([('SectID', 1046), ('RMSect', 'CB1 1'),
            ('GISSect', 'CB 1 1'), ('StrSect', 'CB11'), ('PostDist', 'CB1'),
            ('PostArea', 'CB'), ('DistNum', '1'), ('SecNum', 1), ('PCCnt', 107),
            ('AnomCnt', 0), ('RefPC', 'CB11DP'), ('x', 545708),
            ('y', 258524), ('Sprawl', 'Cambridge'), ('Locale', None)]),
        'geometry': {
            'type': 'Polygon', 'coordinates': [[(545081.0927873488, 258778.53467021856),
            (545148.2158297729, 258767.60779800318), (545182.0947858373, 258794.72003720546),
            (545266.80454359, 258787.9419774049), (545331.1819806674, 258726.94943633815),
            (545382.0127823557, 258747.28361573984), (545466.7225401084, 258750.66264850178),
            (545514.156376623, 258706.61525693646), (545568.3758984238, 258730.33846623843),
            (545615.8097349384, 258764.2187681029), (545622.5871751636, 258689.6801045734),
            (545737.7954139293, 258693.06913447368), (545734.4066938167, 258784.55294750462),
            (545995.3134072999, 258794.72003720546), (546046.1359639271, 258760.82973820262),
            (546169.7706551381, 258808.59606523375), (546168.294789201, 258805.63691228247),
            (546177.9415106893, 258791.5609414872), (546204.8039197567, 258752.39215343614),
            (546196.0971352339, 258746.24391335156), (546195.1489532073, 258741.2053556237),
            (546193.9781545309, 258699.76721716745), (546151.9613231597, 258680.0528603434),
            (546147.6161759595, 258676.5838533363), (546143.007186804, 258672.99488066908),
            (546139.9812493798, 258669.00602246786), (546139.0495574754, 258667.97631721792),
            (546132.9647023828, 258661.00831178873), (546125.9976257524, 258647.00232096188),
            (546124.9834832369, 258641.96376323403), (546123.9775857825, 258632.0266077152),
            (546126.9870330845, 258632.0066134385), (546133.9788448982, 258628.98747765715),
            (546141.0118820175, 258626.96805571066), (546147.9954487701, 258622.049463643),
            (546156.9825653703, 258611.96235104895), (546160.9814200043, 258605.96406803958),
            (546164.955539455, 258598.956074057), (546167.0168047303, 258594.0074905743),
            (546167.9484966347, 258590.02862951142), (546167.9979670014, 258586.0197770335),
            (546179.4256216874, 258588.1391703635), (546188.9486672592, 258589.9786438197),
            (546191.9333793778, 258574.373110857), (546191.9498695, 258574.0432052915),
            (546196.0064395618, 258550.0100847007), (546195.9981945007, 258548.00065989257),
            (546198.958171436, 258544.97152697286), (546200.9699663447, 258544.03179596807),
            (546205.001801223, 258544.04179310641), (546206.9888609485, 258543.9818102763),
            (546207.7144263254, 258544.09177879815), (546205.3893190948, 258499.92442157265),
            (546164.7329228054, 258466.04411970818), (546113.902121117, 258445.7099403065),
            (546086.7923602166, 258496.53539167237), (546080.0231650526, 258564.30599253965),
            (546069.8570047149, 258632.07659340696), (546046.1359639271, 258649.01174577003),
            (546029.1923633643, 258608.353384105), (546042.7472438145, 258560.91696263937),
            (546035.9698035894, 258516.86957107406), (546015.6374829141, 258462.6550898079),
            (546019.0262030266, 258333.89194787387), (546007.8706353569, 258258.6234932449),
            (546007.0955996134, 258258.83343315023), (545995.6267196217, 258262.72231996796),
            (545991.405248338, 258264.38184493387), (545988.0907337753, 258265.6114929508),
            (545987.2167572987, 258264.9216904047), (545981.6266058721, 258260.69290088312),
            (545903.8262093221, 258320.3458254111), (545886.8826087593, 258184.8046236765),
            (545822.505171682, 258117.0340228092), (545758.1194895435, 258052.66244898055),
            (545703.9082128038, 257906.95415754511), (545641.8393928347, 257940.38458818386),
            (545624.1537367728, 257904.24493305254), (545641.1385626411, 257876.092991462),
            (545583.637506522, 257817.11987234175), (545516.6381400145, 257787.49835141393),
            (545514.156376623, 257791.7471352122), (545514.156376623, 257862.90676597977),
            (545559.0342441963, 257939.45485431742), (545571.7646185365, 257961.16863881127),
            (545564.9871783113, 258032.32826957884), (545405.7338231435, 258198.36074327762),
            (545372.2753651952, 258206.88830228924), (545382.0127823557, 258215.29589564068),
            (545246.4804679758, 258374.5503095389), (545192.5165430692, 258362.29381792314),
            (545078.5615535908, 258550.58991872496), (545053.9088208985, 258594.67729884366),
            (545044.3692852046, 258589.23885558185), (545043.1737513449, 258591.40823460356),
            (545005.9060751679, 258649.01174577003), (545043.1737513449, 258669.3459251717),
            (545090.6075878595, 258689.67010743506), (545081.0927873488, 258778.53467021856)]]
            }}


@fixture(scope='function')
def setup_lad():
    return [
        {
            "id": 1,
            "name": "Cambridge",
        }
    ]

@fixture(scope='function')
def setup_pcd_sector():
    return [
        {
            "id": "CB11",
            "lad_id": 1,
            "population": 500,
            "area": 2,
            "user_throughput": 2,
        },
        {
            "id": "CB12",
            "lad_id": 1,
            "population": 200,
            "area": 2,
            "user_throughput": 2,
        }
    ]

@fixture(scope='function')
def setup_non_4g_assets():
    return [
        {
            "pcd_sector": "CB11",
            "site_ngr": "site_100",
            "technology": "",
            "type": "macrocell_site",
            "frequency": [],
            "bandwidth": "",
            "build_date": 2012,
            "sectors": 3,
        },
        {
            "pcd_sector": "CB12",
            "site_ngr": "site_200",
            "technology": "",
            "type": "macrocell_site",
            "frequency": [],
            "bandwidth": "",
            "build_date": 2012,
            "sectors": 3,
        }
    ]

@fixture(scope='function')
def setup_assets():
    return [
        {
            "pcd_sector": "CB11",
            "site_ngr": "site_100",
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800", "2600"],
            "bandwidth": "10",
            "build_date": 2017,
            "sectors": 3,
        },
        {
            "pcd_sector": "CB12",
            "site_ngr": "site_200",
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800", "2600"],
            "bandwidth": "10",
            "build_date": 2017,
            "sectors": 3,
        },
    ]

@fixture(scope='function')
def setup_mixed_assets():
    return [
        {
            "pcd_sector": "CB11",
            "site_ngr": "site_100",
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800", "2600"],
            "bandwidth": "10",
            "build_date": 2017,
            "sectors": 3,
        },
        {
            "pcd_sector": "CB12",
            "site_ngr": "site_200",
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800", "2600"],
            "bandwidth": "10",
            "build_date": 2017,
            "sectors": 3,
        },
        {
            'pcd_sector': "CB11",
            'site_ngr': 'small_cell_site',
            'frequency': '3700',
            'technology': 'same',
            'type': 'small_cell',
            'bandwidth': '25',
            'sectors': 1,
            'build_date': None,
        },
        {
            'pcd_sector': "CB11",
            'site_ngr': 'small_cell_site',
            'frequency': '3700',
            'technology': 'same',
            'type': 'small_cell',
            'bandwidth': '25',
            'sectors': 1,
            'build_date': None,
        },
        {
            'pcd_sector': "CB12",
            'site_ngr': 'small_cell_site',
            'frequency': '3700',
            'technology': 'same',
            'type': 'small_cell',
            'bandwidth': '25',
            'sectors': 1,
            'build_date': None,
        },
        {
            'pcd_sector': "CB12",
            'site_ngr': 'small_cell_site',
            'frequency': '3700',
            'technology': 'same',
            'type': 'small_cell',
            'bandwidth': '25',
            'sectors': 1,
            'build_date': None,
        },
    ]


@fixture(scope='function')
def setup_six_sectored_assets():
    return [
        {
            "pcd_sector": "CB11",
            "site_ngr": "site_100",
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800", "2600"],
            "bandwidth": "10",
            "build_date": 2017,
            "sectors": 6,
        },
        {
            "pcd_sector": "CB12",
            "site_ngr": "site_200",
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800", "2600"],
            "bandwidth": "10",
            "build_date": 2017,
            "sectors": 6,
        }
    ]


@fixture(scope='function')
def setup_site_sectors():
    return 3


@fixture(scope='function')
def setup_capacity_lookup():
    return {
        ("urban", "700", "10", '30'): [
            (0, 0),
            (1, 2),
        ],
        ("urban", "800", "10", '30'): [
            (0, 0),
            (1, 2),
        ],
        ("urban", "2600", "10", '30'): [
            (0, 0),
            (3, 5),
        ],
        ("urban", "3500", "80", '30'): [
            (0, 0),
            (3, 5),
        ],
        ('small_cells', '3700', '25', '30'): [
            (0, 0),
            (3, 10),
        ],
        ("rural", "700", "10", '30'): [
            (0, 0),
            (1, 2),
        ],
        ("rural", "800", "10", '30'): [
            (0, 0),
            (0.25, 0.5),
            (0.5, 1),
            (0.75, 1.5),
            (1, 2),
            (2, 4),
        ],
        ("rural", "2600", "10", '30'): [
            (0, 0),
            (2, 4),
            (3, 5),
        ],
        ("rural", "3500", "80", '30'): [
            (0, 0),
            (3, 5),
        ],
        ("rural", "1800", "10", '30'): [
            (0, 0),
            (0, 0),
        ],
        ("urban", "700", "10", '40'): [
            (0, 0),
            (2, 4),
        ],
        ("urban", "800", "10", '40'): [
            (0, 0),
            (2, 4),
        ],
        ("urban", "2600", "10", '40'): [
            (0, 0),
            (6, 10),
        ],
        ("urban", "3500", "80", '40'): [
            (0, 0),
            (6, 10),
        ],
        ('small_cells', '3700', '25', 'small_cells'): [
            (0, 0),
            (2, 10),
            (4, 20),
            (5, 25),
        ],
        ("rural", "700", "10", '40'): [
            (0, 0),
            (2, 4),
        ],
        ("rural", "800", "10", '40'): [
            (0, 0),
            (2, 4),
        ],
        ("rural", "2600", "10", '40'): [
            (0, 0),
            (6, 10),
        ],
        ("rural", "3500", "80", '40'): [
            (0, 0),
            (6, 10),
        ],
        ("rural", "1800", "10", '40'): [
            (0, 0),
            (0, 0),
        ],
    }


@fixture(scope='function')
def setup_clutter_lookup():
    return  [
        (0.0, 'rural'),
        (782.0, 'Suburban'),
        (7959.0, 'urban'),
    ]


@fixture(scope='function')
def setup_service_obligation_capacity():
    return 2


@fixture(scope='function')
def setup_traffic():
    return 0.15


@fixture(scope='function')
def setup_market_share():
    return 0.25


@fixture(scope='function')
def setup_mast_height():
    return 30

@fixture(scope='function')
def setup_modulation_coding_lut():
    return [
        #CQI Index	Modulation	Coding rate	Spectral efficiency (bps/Hz) SINR estimate (dB)
        ('4G', 1, 'QPSK',	0.0762,	0.1523, -6.7),
        ('4G', 2, 'QPSK',	0.1172,	0.2344, -4.7),
        ('4G', 3, 'QPSK',	0.1885,	0.377, -2.3),
        ('4G', 4, 'QPSK',	0.3008,	0.6016, 0.2),
        ('4G', 5, 'QPSK',	0.4385,	0.877, 2.4),
        ('4G', 6, 'QPSK',	0.5879,	1.1758,	4.3),
        ('4G', 7, '16QAM', 0.3691, 1.4766, 5.9),
        ('4G', 8, '16QAM', 0.4785, 1.9141, 8.1),
        ('4G', 9, '16QAM', 0.6016, 2.4063, 10.3),
        ('4G', 10, '64QAM', 0.4551, 2.7305, 11.7),
        ('4G', 11, '64QAM', 0.5537, 3.3223, 14.1),
        ('4G', 12, '64QAM', 0.6504, 3.9023, 16.3),
        ('4G', 13, '64QAM', 0.7539, 4.5234, 18.7),
        ('4G', 14, '64QAM', 0.8525, 5.1152, 21),
        ('4G', 15, '64QAM', 0.9258, 5.5547, 22.7),
        ('5G', 1, 'QPSK', 78, 0.1523, -6.7),
        ('5G', 2, 'QPSK', 193, 0.377, -4.7),
        ('5G', 3, 'QPSK', 449, 0.877, -2.3),
        ('5G', 4, '16QAM', 378, 1.4766, 0.2),
        ('5G', 5, '16QAM', 490, 1.9141, 2.4),
        ('5G', 6, '16QAM', 616, 2.4063, 4.3),
        ('5G', 7, '64QAM', 466, 2.7305, 5.9),
        ('5G', 8, '64QAM', 567, 3.3223, 8.1),
        ('5G', 9, '64QAM', 666, 3.9023, 10.3),
        ('5G', 10, '64QAM', 772, 4.5234, 11.7),
        ('5G', 11, '64QAM', 873, 5.1152, 14.1),
        ('5G', 12, '256QAM', 711, 5.5547, 16.3),
        ('5G', 13, '256QAM', 797, 6.2266, 18.7),
        ('5G', 14, '256QAM', 885, 6.9141, 21),
        ('5G', 15, '256QAM', 948, 7.4063, 22.7),
        ]


@fixture(scope='function')
def setup_built_interventions():
    return [
        {
            "pcd_sector": "CB11",
            "site_ngr": 100,
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["800"],
            "bandwidth": "10",
            "build_date": 2017
        },
        {
            "pcd_sector": "CB12",
            "site_ngr": 200,
            "technology": "LTE",
            "type": "macrocell_site",
            "frequency": ["2600"],
            "bandwidth": "10",
            "build_date": 2017
        }
    ]


@fixture(scope='function')
def setup_interventions():
    return {
    'upgrade_to_lte': {
        'name': 'Upgrade site to LTE',
        'description': 'If a site has only 2G/3G',
        'result': '800 and 2600 bands available',
        'cost': 142446,
        'assets_to_build': [
            {
                # site_ngr to match upgraded
                'site_ngr': None,
                'frequency': '800',
                'technology': 'LTE',
                'type': 'macrocell_site',
                'bandwidth': '10',
                # set build date when deciding
                'build_date': None,
            },
            {
                # site_ngr to match upgraded
                'site_ngr': None,
                'frequency': '2600',
                'technology': 'LTE',
                'type': 'macrocell_site',
                'bandwidth': '10',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'carrier_700': {
        'name': 'Build 700 MHz carrier',
        'description': 'Available if a site has LTE',
        'result': '700 band available',
        'cost': 50917,
        'assets_to_build': [
            {
                # site_ngr to match upgraded
                'site_ngr': None,
                'frequency': '700',
                'technology': 'LTE',
                'type': 'macrocell_site',
                'bandwidth': '10',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'carrier_3500': {
        'name': 'Build 3500 MHz carrier',
        'description': 'Available if a site has LTE',
        'result': '3500 band available',
        'cost': 50917,
        'assets_to_build': [
            {
                # site_ngr to match upgraded
                'site_ngr': None,
                'frequency': '3500',
                'technology': 'LTE',
                'type': 'macrocell_site',
                'bandwidth': '10',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'sectorisation': {
        'name': 'sectorisation carrier',
        'description': 'Available if a site has LTE',
        'result': '6 sectors are available',
        'cost': 50000, #£10k each, plus £20 installation
        'assets_to_build': [
            {
                # site_ngr to match upgraded
                'site_ngr': None,
                'frequency': 'x6_sectors',
                'technology': 'same',
                'type': 'macrocell_site',
                'bandwidth': 'same',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'build_macro_site': {
        'name': 'Build a new macro site',
        'description': 'Must be deployed at preset densities \
            to be modelled',
        'result': 'Macrocell sites available at given density',
        'cost': 150000,
        'assets_to_build': [
            {
                # site_ngr not used
                'site_ngr': 'new_macro_site',
                'frequency': 'same',
                'technology': 'same',
                'type': 'macro_site',
                'bandwidth': 'same',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'small_cell': {
        'name': 'Build a small cell',
        'description': 'Must be deployed at preset densities \
            to be modelled',
        'result': '2x25 MHz small cells available at given density',
        'cost': 40220,
        'assets_to_build': [
            {
                # site_ngr not used
                'site_ngr': 'small_cell_sites',
                'frequency': '3700',
                'technology': '5G',
                'type': 'small_cell',
                'bandwidth': '25',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'raise_mast_height': {
        'name': 'Raises existing mast height',
        'description': 'Must be deployed at preset densities to \
            be modelled',
        'result': 'Same technology but with new enhanced capacity',
        'cost': 30000,
        'assets_to_build': [
            {
                # site_ngr not used
                'site_ngr': 'extended_height',
                'frequency': 'same',
                'technology': 'same',
                'type': 'extended_height_macro',
                'bandwidth': 'same',
                # set build date when deciding
                'build_date': None,
            },
        ]
    },
    'deploy_c_ran': {
        'name': 'Replace D-Ran with C-RAN',
        'description': 'Must be deployed within viable distance \
            from exchange',
        'result': 'Network architecture change to SDN/NFV',
        'cost': 30000,
        'assets_to_build': [
            {
                'site_ngr': 'c_ran',
                'frequency': 'same',
                'technology': '5G c_ran',
                'type': 'macro_c_ran',
                'bandwidth': 'same',
                'build_date': None,
            },
        ]
    },
}


@fixture(scope='function')
def setup_strategies():
    return {
    'minimal': (),
    'macrocell_700_3500': (
        'upgrade_to_lte', 'carrier_700', 'carrier_3500'
        ),
    'macrocell_700': ('upgrade_to_lte', 'carrier_700'),
    'sectorisation': (
        'upgrade_to_lte', 'carrier_700',
        'carrier_3500', 'x6_sectors'
        ),
    'macro_densification': ('build_macro_site'),
    'deregulation': ('raise_mast_height'),
    'cloud_ran': ('deploy_c_ran'),
    'small_cell': ('upgrade_to_lte', 'small_cell'),
    'small_cell_and_spectrum': (
        'upgrade_to_lte', 'carrier_700',
        'carrier_3500', 'small_cell'
        ),
    }

@fixture(scope='function')
def setup_fixed_model_pcp():
    return [
        ((-1.944580, 52.792175), {'Name': 'cab_1', 'Type': 'pcp'}),
        ((-0.395508, 52.485498), {'Name': 'cab_2', 'Type': 'pcp'}),
        ((-2.713623, 52.652437), {'Name': 'cab_3', 'Type': 'pcp'}),
        (( 0.417480, 51.147694), {'Name': 'cab_4', 'Type': 'pcp'}),
        (( 1.219482, 52.431944), {'Name': 'cab_5', 'Type': 'pcp'}),
        ((-1.900635, 51.223443), {'Name': 'cab_6', 'Type': 'pcp'}),
        (( 0.802002, 51.154586), {'Name': 'cab_7', 'Type': 'pcp'})
    ]


@fixture(scope='function')
def setup_fixed_model_exchanges():
    return [
        ((-0.572275, 51.704581), {'Name': 'EAARR', 'Type': 'exchange'}),
        (( 0.537344, 51.745323), {'Name': 'EABTM', 'Type': 'exchange'})
    ]


@fixture(scope='function')
def setup_fixed_model_corenodes():
    return [
        ((0.3, 51.825323), {'Name': 'CoreNode', 'Type': 'core'})
    ]


@fixture(scope='function')
def setup_fixed_model_links():
    return [
        ([(-0.572275, 51.704581), (0, 52), (-1.944580, 52.792175)], {'Origin': 'EAARR',    'Dest': 'cab_1', 'Type': 'link', 'Physical': 'fiberglass'}),
        ([(-0.572275, 51.704581), (0, 52), (-0.395508, 52.485498)], {'Origin': 'EAARR',    'Dest': 'cab_2', 'Type': 'link', 'Physical': 'fiberglass'}),
        ([(-0.572275, 51.704581), (0, 52), (-2.713623, 52.652437)], {'Origin': 'EAARR',    'Dest': 'cab_3', 'Type': 'link', 'Physical': 'fiberglass'}),
        ([(-0.572275, 51.704581), (0, 52), ( 0.417480, 51.147694)], {'Origin': 'EAARR',    'Dest': 'cab_4', 'Type': 'link', 'Physical': 'fiberglass'}),
        ([( 0.537344, 51.745323), (0, 52), ( 1.219482, 52.431944)], {'Origin': 'EABTM',    'Dest': 'cab_5', 'Type': 'link', 'Physical': 'copper'    }),
        ([( 0.537344, 51.745323), (0, 52), (-1.900635, 51.223443)], {'Origin': 'EABTM',    'Dest': 'cab_6', 'Type': 'link', 'Physical': 'copper'    }),
        ([( 0.537344, 51.745323), (0, 52), ( 0.802002, 51.154586)], {'Origin': 'EABTM',    'Dest': 'cab_7', 'Type': 'link', 'Physical': 'copper'    }),
        ([( 0.3,      51.825323), (0, 51), (-0.572275, 51.704581)], {'Origin': 'CoreNode', 'Dest': 'EAARR', 'Type': 'link', 'Physical': 'copper'    }),
        ([( 0.3,      51.825323), (0, 51), ( 0.537344, 51.745323)], {'Origin': 'CoreNode', 'Dest': 'EABTM', 'Type': 'link', 'Physical': 'copper'    })
    ]

@fixture(scope='function')
def setup_cb41_postcode_sector():
    return {
        'type': 'Feature', 'id': '1062',
        'properties': OrderedDict([('SectID', 1063), ('RMSect', 'CB4 3'),
            ('GISSect', 'CB 4 3'), ('StrSect', 'CB43'), ('PostDist', 'CB4'),
            ('PostArea', 'CB'), ('DistNum', '4'), ('SecNum', 3), ('PCCnt', 226),
            ('AnomCnt', 1), ('RefPC', 'CB43HE'), ('x', 544563), ('y', 260046),
            ('Sprawl', 'Cambridge'), ('Locale', None)]),
        'geometry': {
            'type': 'Polygon', 'coordinates': [[(543476.9831698855, 260743.62216977304),
            (543486.2835988075, 260738.37367213986), (543498.1235065487, 260747.40108806893),
            (543506.2119114888, 260753.53933101517), (543607.5272222991, 260830.70724193045),
            (543607.6591432767, 260830.82720759063), (543585.6200949536, 260871.81547482117),
            (543544.0155166374, 260949.19332564177), (543541.2699112907, 260954.23188336962),
            (543560.5798443895, 260971.70688120354), (543554.2311473417, 260984.81312957895),
            (543758.7169077101, 261127.1923739442), (543770.8948629564, 261148.83617846962),
            (543770.7217166732, 261147.25663061047), (544202.9443097151, 261179.53739033913),
            (544231.2578495363, 261194.70304921444), (544316.1902239387, 261179.247473327),
            (544381.540578226, 261403.45329507813), (544402.5902192171, 261461.25674901155),
            (544554.7528218379, 261422.1279495139), (544761.8027962088, 261359.1159865007),
            (544797.8172230984, 261053.03360167195), (544689.1390727247, 260952.122487178),
            (544693.1296822977, 260947.57378922927), (544697.1780072983, 260944.6846162464),
            (544683.6643521537, 260887.97085039303), (544683.532431176, 260887.85088473285),
            (544682.9882571433, 260885.391588699), (544682.9965022044, 260885.1716516553),
            (544680.9187468069, 260876.53412412186), (544678.0577106049, 260864.65752376337),
            (544677.9999951771, 260859.64895745055), (544678.0989359104, 260858.64924361565),
            (544679.2449994035, 260854.4504455091), (544676.3097576514, 260816.97117383903),
            (544655.3837925768, 260817.1311280526), (544649.5380442562, 260813.73210101397),
            (544635.2823336123, 260810.31307969865), (544629.2634390085, 260810.47303391225),
            (544610.0689367652, 260817.26109085116), (544601.2302312648, 260822.67953983624),
            (544593.826166396, 260830.4773077484), (544593.6200398685, 260830.46731061005),
            (544590.552877139, 260830.15739932124), (544582.0274839604, 260831.79693001046),
            (544573.6175216372, 260834.22623462926), (544562.6021200061, 260834.5661373331),
            (544560.2687677145, 260835.0559971122), (544550.3829394543, 260838.66496405617),
            (544541.7008901149, 260843.64353895394), (544538.0648181693, 260846.32277203145),
            (544533.554769747, 260846.30277775475), (544523.7019217311, 260849.02199938564),
            (544521.244893523, 260849.15196218417), (544437.73066963, 260800.97575248076),
            (544464.7332447361, 260737.96378946755), (544752.8074345475, 260692.94667548238),
            (544800.6617691782, 260663.81501433364), (544840.9471377182, 260654.04781016675),
            (544872.9627099738, 260645.96012524248), (544877.9921972455, 260644.5505287353),
            (544880.1029328873, 260644.84044574742), (544881.9828068183, 260643.89071760426),
            (544882.2054234681, 260643.23090647324), (544882.9639690894, 260643.03096370626),
            (544890.0052512698, 260643.01096942957), (544890.9616783574, 260643.0409608446),
            (544898.011205599, 260645.03039137603), (544903.9558946528, 260644.9804056843),
            (544980.4370814266, 260626.6256596757), (544982.1602991967, 260626.23577128007),
            (544980.7668838707, 260622.40686729245), (544980.8905597872, 260620.5174081445),
            (544978.1696896238, 260613.08953435125), (544975.5065348882, 260608.34089363553),
            (544972.3981468531, 260600.12324591272), (544971.9941388591, 260602.11267644414),
            (544955.1247438462, 260608.5208421258), (544951.6288379394, 260608.98071048985),
            (544945.0245439974, 260608.00099093167), (544934.7429528043, 260604.4720010945),
            (544934.0668577941, 260604.1221012523), (544927.4625638521, 260598.47371808515),
            (544927.2646823856, 260598.4637209468), (544924.1398042283, 260593.03527482334),
            (544921.2705229651, 260585.93730659562), (544921.0231711321, 260585.14753266604),
            (544921.0808865598, 260580.69880610076), (544920.1491946554, 260572.8810439119),
            (544919.5802854394, 260571.2015246693), (544919.1762774454, 260568.8521971573),
            (544916.6203085041, 260564.87333609443), (544913.0337069251, 260556.75565975512),
            (544910.7333348779, 260548.78794049105), (544910.5272083504, 260546.55857863923),
            (544909.3811448574, 260541.51002377304), (544907.3775950097, 260537.34121708153),
            (544906.6850098773, 260535.3117979967), (544906.6272944496, 260535.09186095302),
            (544906.6355395106, 260534.64198972733), (544901.3587004059, 260523.4751861916),
            (544897.9699802934, 260517.9167772696), (544897.4670315662, 260516.45719507063),
            (544896.22202734, 260509.849086622), (544896.1972921566, 260508.5194672216),
            (544895.900469957, 260506.94991650083), (544895.5211971464, 260505.9402055276),
            (544892.2396628282, 260489.47491866694), (544894.3174182256, 260486.31582294867),
            (544893.4434417489, 260483.5066270726), (544886.2537484687, 260460.47322031672),
            (544880.6141266756, 260454.63489152095), (544870.9838953095, 260449.56634237806),
            (544870.1181638939, 260448.87653983198), (544869.8295867554, 260447.0870520675),
            (544868.4526615514, 260442.58833981052), (544867.8755072744, 260439.0093642816),
            (544865.7400364492, 260434.9405289736), (544864.1982100233, 260429.33213435984),
            (544863.5550952575, 260427.75258650072), (544861.8978379761, 260421.36441509577),
            (544893.2290701603, 260397.2313231215), (544893.4351966878, 260397.131351738),
            (544896.2302724011, 260404.33928848756), (544899.6684628802, 260413.22674447976),
            (544900.8145263733, 260416.04593749414), (544904.054835386, 260424.48352226062),
            (544905.1349383902, 260427.08277823136), (544906.7262351827, 260431.13161926265),
            (544908.2598165476, 260434.85055472844), (544909.6614769348, 260438.44952453405),
            (544910.0407497454, 260439.46923264564), (544915.713351783, 260453.5452034409),
            (544922.6556932301, 260470.89023847628), (544923.4801993403, 260472.9196575611),
            (544924.6922233221, 260476.06875614103), (544929.0208804002, 260486.88565983454),
            (544929.086840889, 260486.88565983454), (544932.8795689954, 260485.76598033946),
            (544936.3837199635, 260484.77626364294), (544905.844013645, 260377.87686327798),
            (544770.8064029311, 260341.8671709452), (544752.8074345475, 260197.82840161404),
            (544860.8342250941, 260125.80901694845), (544932.8465887511, 260179.82355544763),
            (545049.8769860201, 260098.80674626803), (545076.8795611262, 259963.77539858923),
            (545238.9197469461, 259981.78024475562), (545337.9429307703, 259837.74147542447),
            (545370.6675782806, 259829.56381625505), (545337.9429307703, 259779.22822466824),
            (545153.5174040609, 259702.7601134374), (545155.0839656701, 259686.3248179918),
            (545131.0496125604, 259656.70329706394), (545225.4225819235, 259545.16522450512),
            (545292.9331422194, 259522.6616660817), (545301.9367489418, 259410.13387682632),
            (545307.9968688511, 259393.68858424234), (545247.9233536685, 259333.61577990372),
            (545162.2324336447, 259259.34703910962), (545134.5372734062, 259302.72462240557),
            (545123.0354131701, 259347.5717850388), (545121.6832231495, 259347.09192239805),
            (545115.7880044623, 259345.2424518035), (545111.7231893394, 259344.01280378658),
            (545100.7572580749, 259340.24388262906), (545093.6500154058, 259337.69461235008),
            (545092.1576593465, 259337.20475257098), (545083.9785587342, 259334.18561678962),
            (545077.7370474807, 259332.33614619507), (545070.7617257892, 259330.23674714178),
            (545066.1527366337, 259328.7671678045), (545063.6462380589, 259327.91741104485),
            (545052.2103383117, 259324.01852708877), (545041.9205020575, 259320.37956872975),
            (545027.4998901917, 259315.5009652155), (545019.77426794, 259313.16163484185),
            (545019.6423469624, 259313.05166632), (545019.4362204348, 259312.9317006598),
            (545014.9014368292, 259311.57208984435), (545009.9626452297, 259309.76260780322),
            (545007.1180991498, 259308.782888245), (545005.2217350965, 259308.0630942839),
            (545003.8695450759, 259307.5732345048), (545000.0191015417, 259306.13364658254),
            (544991.716325013, 259302.21476834978), (544989.762245532, 259301.26504020664),
            (544987.2722370795, 259300.0753807431), (544985.7221655924, 259299.36558392033),
            (544983.7021256227, 259298.30588725535), (544980.8163542373, 259296.32645386228),
            (544976.1908749596, 259293.07738389887), (544976.1249144707, 259292.96741537703),
            (544971.7632771482, 259290.16821663934), (544971.095427199, 259289.69835113693),
            (544971.0294667103, 259289.69835113693), (544965.7361374834, 259285.97941567114),
            (544963.5182160472, 259284.68978482412), (544959.7584681851, 259282.36045158884),
            (544955.2566648239, 259279.66122423462), (544953.3767908928, 259278.4915590478),
            (544941.6275788237, 259270.91372817932), (544939.7477048927, 259269.75406013086),
            (544930.562706826, 259263.58582576958), (544925.7970615096, 259260.43672718966),
            (544922.0455587086, 259257.87745977234), (544915.144442567, 259253.2287904401),
            (544909.3069393074, 259249.26992365392), (544906.3634524944, 259247.07055321717),
            (544903.4199656813, 259244.76121425856), (544901.4823763225, 259243.25164636786),
            (544895.8015292238, 259238.74293697253), (544888.1913378275, 259232.62468830298),
            (544884.9262936314, 259229.7455124585), (544881.1253204639, 259226.2964997281),
            (544875.7990109925, 259221.35791338375), (544875.5351690373, 259221.12797920173),
            (544866.7376888425, 259213.1902513527), (544863.2170477522, 259209.85120714415),
            (544857.486730287, 259204.57271809594), (544849.9095191351, 259197.11485288764),
            (544841.0213432681, 259187.9474770217), (544835.3157609862, 259181.87921404387),
            (544834.4500295705, 259180.96947445415), (544834.0542666377, 259180.50960609008),
            (544830.813957625, 259176.74068493253), (544827.1696406183, 259172.8517981148),
            (544824.86102351, 259169.89264516355), (544820.3922003931, 259163.74440507896),
            (544818.7514332341, 259161.36508615193), (544818.42163079, 259160.88522351117),
            (544779.8100096536, 259153.57731537812), (544662.7796123845, 259108.56020139295),
            (544606.5235604917, 259180.15970624788), (544608.263268384, 259186.04802073538),
            (544608.5600905837, 259187.61757145615), (544608.584825767, 259189.1771250386),
            (544608.9476084554, 259200.0940001156), (544609.0218140053, 259202.09342778538),
            (544609.0053238831, 259202.65326753294), (544608.7909522945, 259203.20311014212),
            (544608.7497269891, 259206.76209139434), (544608.7002566224, 259210.8809123941),
            (544608.675521439, 259211.77065770715), (544608.8404226612, 259217.89890351502),
            (544609.0465491887, 259236.49358084402), (544609.1207547386, 259238.7229426958),
            (544608.988833761, 259240.94230740928), (544609.153734983, 259244.51128579985),
            (544609.2032053496, 259245.1810940692), (544609.5000275492, 259246.6306791298),
            (544609.5494979158, 259247.3004873992), (544610.1019170096, 259249.6498149112),
            (544610.6378459812, 259252.2290766052), (544610.8274823865, 259252.78891635273),
            (544611.1407947084, 259253.68865880414), (544611.5860280078, 259254.81833543757),
            (544611.9817909406, 259255.4981408453), (544612.4352693012, 259256.28791477488),
            (544612.50122979, 259256.28791477488), (544612.7650717453, 259256.63781461708),
            (544613.0289137005, 259256.97771732093), (544613.639048222, 259257.32761716316),
            (544613.9028901772, 259257.44758282334), (544614.4470642098, 259257.6875141437),
            (544614.7768666539, 259257.91744832572), (544616.4011436908, 259258.74721080868),
            (544619.4188360538, 259260.6066785416), (544622.3705679281, 259262.47614341284),
            (544622.7745759219, 259262.82604325505), (544624.2669319813, 259260.9765726605),
            (544626.5673040285, 259259.3770305247), (544627.1279681834, 259258.94715357566),
            (544627.3340947109, 259258.83718505382), (544627.8617786213, 259259.40702193973),
            (544628.9171464423, 259260.77662989352), (544629.6427118193, 259261.68636948327),
            (544630.360032135, 259262.93601177688), (544631.341194406, 259264.4055911142),
            (544632.3965622269, 259265.88516758982), (544632.5861986323, 259266.3350388155),
            (544633.4271948646, 259267.81461529116), (544634.0785546916, 259268.9442919246),
            (544634.7876299463, 259270.63380830555), (544634.9690212905, 259271.1936480531),
            (544635.5461755675, 259272.65323025204), (544636.0491242948, 259274.23277811115),
            (544636.1068397225, 259274.45271515485), (544636.1645551502, 259274.7926178587),
            (544636.3541915555, 259275.46242612807), (544636.5850532664, 259276.92200832703),
            (544636.6345236329, 259277.5918165964), (544636.5438279608, 259278.25162772744),
            (544636.4283971054, 259280.03111835354), (544636.2470057611, 259281.36073775394),
            (544636.0985946613, 259281.91058036312), (544636.0078989892, 259282.58038863252),
            (544635.4884601398, 259284.11994793825), (544635.2575984291, 259284.8897275911),
            (544634.7464046408, 259285.87944428765), (544634.6062386021, 259285.9894128095),
            (544634.3918670134, 259286.319318375), (544634.0373293861, 259286.749195324),
            (544633.6910368198, 259286.95913522932), (544633.4107047424, 259287.17907227302),
            (544632.7181196099, 259287.59895208367), (544632.4377875325, 259287.7089206055),
            (544632.3058665548, 259287.69892346716), (544628.7687353425, 259289.37844270977),
            (544625.0996831525, 259290.9379962922), (544624.893556625, 259291.04796481403),
            (544624.3328924701, 259291.247907581), (544621.0925834574, 259292.37758421444),
            (544618.8169465935, 259292.86744399354), (544618.5531046382, 259292.7574754717),
            (544618.0748910944, 259292.62751267318), (544617.3328355952, 259292.2676156926),
            (544617.1926695566, 259292.2676156926), (544612.4600044845, 259293.01740106876),
            (544611.9570557574, 259293.6772121998), (544608.7497269891, 259298.2559015636),
            (544607.8922406345, 259299.5655266873), (544606.5400506139, 259301.41499728186),
            (544605.4681926707, 259302.94455944924), (544604.181963139, 259304.80402718214),
            (544603.2585162957, 259305.88371812383), (544602.7638126296, 259306.42356359467),
            (544599.7131400222, 259310.2324733056), (544598.4351555515, 259311.86200685648),
            (544598.0146574354, 259312.30188094382), (544595.9616372212, 259314.80116553107),
            (544594.6836527506, 259316.3207305601), (544594.2549095732, 259316.86057603094),
            (544593.5458343186, 259317.7303270673), (544592.7048380863, 259318.60007810366),
            (544591.6494702654, 259319.45983200165), (544590.5363870166, 259320.31958589965),
            (544590.2560549392, 259320.41955728314), (544589.7778413953, 259320.51952866663),
            (544589.5717148678, 259320.50953152828), (544589.0852562629, 259320.60950291177),
            (544588.7472087578, 259320.59950577343), (544586.6282280547, 259320.53952294335),
            (544585.6718009671, 259320.61950005012), (544585.6058404782, 259320.61950005012),
            (544585.185342362, 259320.7194714336), (544584.4267967407, 259321.02938272242),
            (544583.4538795309, 259321.66919957678), (544581.2854284613, 259323.38870737277),
            (544580.6423136954, 259324.1484898873), (544579.4467798357, 259325.44811787264),
            (544576.1899807007, 259329.1370619234), (544574.8542808024, 259330.5466584306),
            (544572.7270550383, 259333.15591153968), (544571.6634421563, 259334.45553952502),
            (544570.0309200583, 259336.4149786414), (544569.602176881, 259337.07478977245),
            (544569.4537657811, 259337.40469533796), (544568.2252516771, 259339.81400568003),
            (544567.4996863002, 259341.23359932558),(544565.2487846196, 259345.51237453893),
            (544565.034413031, 259345.84228010444), (544564.7458358925, 259346.61205975732),
            (544564.9437173589, 259346.7320254175), (544566.4772987237, 259348.11163050964),
            (544568.3406825325, 259349.83113830566), (544570.2617817691, 259351.89054880553),
            (544571.4490705676, 259353.49009094137), (544571.7046674618, 259353.93996216706),
            (544571.7046674618, 259354.0499306889), (544571.8943038671, 259354.49980191462),
            (544572.1416557002, 259355.399544366), (544572.133410639, 259355.72944993153),
            (544572.0839402725, 259357.3989720358), (544572.0592050891, 259358.178748827),
            (544571.7458927673, 259359.61833674923), (544571.4490705676, 259360.49808492395),
            (544571.1440033069, 259361.59777014234), (544571.069797757, 259361.817707186),
            (544570.7812206184, 259362.25758127336), (544570.34423238, 259363.02736092624),
            (544569.2641293758, 259365.1067657028), (544568.8353861986, 259365.65660831198),
            (544565.8918993855, 259370.46523185782), (544561.0850287635, 259378.22301121659),
            (544558.9083326329, 259382.61175495177), (544555.1980551374, 259390.07961729838),
            (544555.0578890987, 259390.17958868187), (544554.84351751, 259390.72943129108),
            (544554.3405687829, 259391.3892424221), (544553.5572879782, 259392.47893050214),
            (544551.8588053915, 259394.53834100201), (544548.321674179, 259398.6671591401),
            (544546.7551125699, 259400.73656677833), (544546.2604089038, 259401.16644372733),
            (544546.120242865, 259401.386380771), (544545.9800768263, 259401.6063178147),
            (544544.7598077834, 259403.3458198874), (544544.2733491784, 259403.78569397476),
            (544543.7044399624, 259404.54547648926), (544542.2285740253, 259405.94507585812),
            (544538.4853162854, 259410.06389685787), (544537.3474978535, 259411.59345902526),
            (544537.1248812038, 259412.0333331126), (544536.6219324766, 259412.79311562714),
            (544534.9894103786, 259414.9724917872), (544534.4864616514, 259415.74227144005),
            (544530.8998600724, 259421.42064602225), (544528.8963102249, 259424.58973887886),
            (544528.6077330863, 259425.13958148804), (544528.5335275364, 259425.24955000987),
            (544527.758491793, 259426.22926956808), (544526.9752109883, 259427.3189576481),
            (544525.7631870065, 259428.94849119897), (544523.5535106313, 259432.00761553374),
            (544521.2696287064, 259435.166711252), (544520.7749250403, 259435.81652524468),
            (544518.3591221377, 259439.08558948478), (544514.1541409761, 259444.86393545044),
            (544510.880851719, 259449.33265629242), (544508.8113413826, 259452.16184644515),
            (544508.7371358327, 259452.27181496698), (544507.6735229506, 259453.69140861253),
            (544507.0304081847, 259454.5611596489), (544506.1811668914, 259455.65084772892),
            (544505.7606687752, 259455.97075615608), (544503.5015220335, 259458.3600722215),
            (544502.0339011574, 259459.64970306848), (544499.9973710655, 259461.3692108645),
            (544496.6416311974, 259463.82850689834), (544496.2953386311, 259464.15841246385),
            (544492.9643339462, 259465.83793170648), (544492.7582074187, 259465.94790022832),
            (544488.5944515627, 259468.04729928158), (544488.1739534466, 259468.2572391869),
            (544486.8547436703, 259468.88705890288), (544475.2786778844, 259474.44546782487),
            (544473.126716937, 259475.50516448988), (544470.2162103683, 259476.7548067835),
            (544469.6637912745, 259476.95474955047), (544467.4458698384, 259478.0044490771),
            (544466.1349051233, 259478.52430027124), (544465.9287785958, 259478.63426879307),
            (544460.6024691245, 259480.7036764313), (544456.9993774233, 259482.1532614919),
            (544447.8720947844, 259485.8921912344), (544446.9651380632, 259486.31207104505),
            (544441.0864094981, 259488.70138711043), (544439.6352787444, 259489.3312068264),
            (544437.969776402, 259490.0609979259), (544435.9662265544, 259490.78079188702),
            (544433.8884711569, 259491.61055436998), (544433.0639650468, 259491.9204656588),
            (544431.2665417268, 259492.42032257625), (544428.1663987527, 259493.22009364414),
            (544426.5833470214, 259493.72994769993), (544425.2723823063, 259494.13983037224),
            (544421.7599862772, 259495.03957282365), (544421.174586939, 259494.01986471206),
            (544416.8624199831, 259487.21181349645), (544414.1745300641, 259483.1329810501),
            (544412.3441264997, 259480.293793759), (544412.0802845445, 259479.95389105513),
            (544403.0354525166, 259483.0330096666), (544393.9906204887, 259485.99216261788),
            (544391.6407780749, 259482.14326435354), (544392.2756477797, 259474.58542776178),
            (544391.0966040422, 259472.7759457206), (544389.2579554167, 259470.04672695138),
            (544389.1260344391, 259469.82678990767), (544386.9658284305, 259466.53773139088),
            (544382.9092583688, 259460.39948844467), (544382.1836929918, 259459.37978033308),
            (544378.3250043966, 259453.59143722904), (544377.2778816367, 259452.00189223158),
            (544373.0234301086, 259445.423775198), (544371.0611055666, 259442.47461938506),
            (544368.3072551588, 259438.2758212785), (544364.9680054128, 259433.1672835822),
            (544364.3166455858, 259432.25754399245), (544359.8560675301, 259435.13671983694),
            (544357.5556954829, 259436.5163249291), (544355.3212839245, 259433.447203456),
            (544352.097465034, 259429.00847402908), (544352.0397496063, 259428.89850550724),
            (544349.0715276098, 259424.90964730602), (544347.6863573448, 259425.539467022),
            (544346.6557247073, 259425.95934683265), (544345.6828074973, 259426.48919516514),
            (544344.7098902874, 259427.00904635928), (544343.7369730774, 259427.53889469177),
            (544341.1562689528, 259429.1384368276), (544335.871184787, 259432.31752682256),
            (544331.62497832, 259434.86679710154), (544328.9783137065, 259436.456342099),
            (544324.7321072394, 259439.11558089982), (544322.2256086647, 259440.60515451382),
            (544321.598984021, 259441.03503146282), (544324.4765103452, 259445.68370079505),
            (544327.0159891645, 259449.9824702851), (544327.7333094802, 259451.11214691852),
            (544328.0548668632, 259451.68198380442), (544329.8193099388, 259454.5211710955),
            (544326.9335385534, 259457.33036697155), (544325.8122102437, 259458.41005791322),
            (544315.0524055067, 259468.77709038105), (544314.260879641, 259474.76537625206),
            (544310.9628552006, 259475.11527609426), (544310.995835445, 259466.9876026166),
            (544310.2950052514, 259435.13671983694), (544177.6154820125, 259556.45199370105),
            (544171.5965874087, 259556.2020652423), (544169.419891278, 259555.80217970835),
            (544159.6494938732, 259555.52225983457), (544159.5835333844, 259555.63222835644),
            (544149.6399896964, 259561.24062297016), (544142.1617192777, 259571.59765829964),
            (544141.1310866402, 259574.0169657801), (544140.141679308, 259577.65592413908),
            (544139.7129361307, 259580.5450971219), (544139.7953867418, 259588.06294516032),
            (544054.013771046, 259598.7898746087), (544031.4223036289, 259617.2046034474),
            (544014.792015388, 259689.2439823897), (544100.6725718171, 259689.2439823897),
            (544103.2202956973, 259692.67300084335), (544104.6549363289, 259695.16228829222),
            (544105.6113634165, 259697.42164155908), (544108.0436564414, 259698.99119227988),
            (544096.1130530281, 259770.5707028581), (543974.1356190984, 259763.79264305753),
            (543948.7243407848, 259786.52613566298), (543934.9468436849, 259769.03114355236),
            (543906.0396594645, 259792.12453313835), (543899.9712944941, 259784.49671657814),
            (543899.9218241274, 259786.15624154406), (543899.7899031498, 259788.27563487404),
            (543893.2763048799, 259793.8740323494), (543880.9911638394, 259807.09024924668),
            (543877.124230183, 259813.20849791623), (543876.8933684721, 259814.2082117511),
            (543868.5246314545, 259815.1879313093), (543849.239433539, 259820.08652910028),
            (543839.0815182624, 259830.8034614103), (543840.4749335885, 259836.9716957716),
            (543840.9531471324, 259839.32102328358), (543841.497321165, 259841.67035079558),
            (543810.2073142864, 259862.35443003947), (543826.8953179551, 259878.6497655482),
            (543829.4100615908, 259883.72831182947), (543839.5844669896, 259891.14618848436),
            (543841.9095742201, 259898.2241624354), (543848.0933700459, 259904.08248550785),
            (543850.2700661767, 259906.82170141547), (543852.8672604235, 259911.68031065303),
            (543854.7388892934, 259913.17988140538), (543859.512779671, 259918.1084706114),
            (543862.4645115451, 259927.20586650888), (543875.5659136348, 259937.60289039178),
            (543877.5529733602, 259941.89166274347), (543878.0971473928, 259942.24156258567),
            (543879.5565232077, 259943.6211676778), (543885.1054493288, 259950.34924178664),
            (543886.8039319156, 259953.06846341753), (543888.4694342581, 259954.4480685097),
            (543890.3905334945, 259956.7374131916), (543892.7486209695, 259960.1364402302),
            (543895.9889299822, 259966.35466028325), (543897.4318156749, 259970.62343835822),
            (543898.173871174, 259971.09330386063), (543907.713406868, 259979.16099450822),
            (543909.428379577, 259981.33037352993), (543912.693423773, 259986.6588482699),
            (543914.6887285595, 259990.82765496138), (543917.2694326842, 259998.695402842),
            (543917.9537727556, 260005.7233911013), (543916.840689507, 260015.71053231184),
            (543908.8182450555, 260046.98158106726), (543908.5214228559, 260047.97129776378),
            (543901.8099431196, 260067.03584059517), (543901.8099431196, 260067.145809117),
            (543903.6815719896, 260085.12066386835), (543904.6050188328, 260086.1503691183),
            (543908.4389722449, 260090.7090642054), (543915.1916772866, 260103.03553578962),
            (543920.4190460248, 260111.42313486437), (543920.9467299352, 260112.11293741042),
            (543926.14936349, 260118.8310143809), (543945.1624743892, 260137.29572891135),
            (543948.007020469, 260138.27544846953), (543953.1107132906, 260141.3145785276),
            (543959.426430094, 260145.2834424521), (543959.9623590657, 260145.63334229434),
            (543965.453569759, 260149.5722148038), (543979.651564975, 260161.898686388),
            (543980.3194149242, 260162.5884889341), (543986.816523072, 260169.4565229798),
            (543988.2758988868, 260171.05606511564), (543988.1852032148, 260176.28456847213),
            (543987.3277168602, 260184.83212176044), (543987.3194717991, 260184.94209028227),
            (543979.1815964923, 260215.6433021518), (543970.3676261753, 260234.41792797105),
            (543966.5006925189, 260240.31623959693), (543964.8516802986, 260238.2668262354),
            (543839.6256922951, 260362.85116433958), (543830.8529472835, 260373.0582425938),
            (543829.995460929, 260372.02853734387), (543815.962366935, 260386.98425631385),
            (543736.9994167697, 260465.05190968054), (543664.9623179294, 260539.98046160565),
            (543664.0471161472, 260541.07014968566), (543663.9811556584, 260540.96018116383),
            (543602.6873714328, 260606.291480274), (543602.6131658829, 260608.85074769132),
            (543571.5540207151, 260642.7910323859), (543569.8885183727, 260641.1814931117),
            (543478.978474672, 260738.0537637127), (543476.9831698855, 260743.62216977304)]]
            }}

@fixture(scope='function')
def setup_transmitters():
    return [
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544655.1049227581, 259555.22477912105],
            },
            'properties': {
                "operator":'voda',
                "opref": 31742,
                "sitengr": 'TL4454059600',
                "ant_height": 14.9,
                "type": 'macro',
                "power": 40,
                "gain": 16,
                "losses": 1,
                "pcd_sector": "CB1 2",
            }
        },
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [545265.1768673284, 259655.21841664566]
            },
            'properties': {
                "operator":'voda',
                "opref": 46497,
                "sitengr": 'TL4515059700',
                "ant_height": 13.7,
                "type": 'macro',
                "power": 40,
                "gain": 16,
                "losses": 1,
                "pcd_sector": "CB1 1",
            }
        },
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [545285.5165949427, 259483.84577720467],
            },
            'properties': {
                "operator":'voda',
                "opref": 31746,
                "sitengr": 'TL4529059480',
                "ant_height": 14.9,
                "type": 'macro',
                "power": 40,
                "gain": 16,
                "losses": 1,
                "pcd_sector": "CB1 2",
            }
        },
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [545885.2027838879, 259595.2986071491]
            },
            'properties': {
                "operator":'voda',
                "opref": 31745,
                "sitengr": 'TL4577059640',
                "ant_height": 14.9,
                "type": 'macro',
                "power": 40,
                "gain": 16,
                "losses": 1,
                "pcd_sector": "CB1 2",
            }
        },
        ]


@fixture(scope='function')
def setup_interfering_sites():
    return [
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [547750.2222151064, 252126.76048813056]
            },
            'properties': {
                "operator":'voda',
                "opref": 31745,
                "sitengr": 'site_id_interfering_1',
                "ant_height": 14.9,
                "type": 'macro',
                "power": 40,
                "gain": 16,
                "losses": 1,
                "pcd_sector": "CB22",
            }
        },
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544809.5557435964, 259520.0001617251]
            },
            'properties': {
                "operator":'voda',
                "opref": 31745,
                "sitengr": 'site_id_interfering_2',
                "ant_height": 14.9,
                "type": 'macro',
                "power": 40,
                "gain": 16,
                "losses": 1,
                "pcd_sector": "CB45",
            }
        }
        ]


@fixture(scope='function')
def setup_receivers():
    return [
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544750.2222151064, 259926.76048813056]
            },
            'properties': {
                "ue_id": "AB1",
                "sitengr": 'TL4454059600',
                "misc_losses": 4,
                "gain": 4,
                "losses": 4,
                "ue_height": 1.5,
                "indoor": True,
            }
        },
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544809.5557435964, 259520.0001617251]
            },
            'properties': {
                "ue_id": "AB3",
                "sitengr": 'TL4454059600',
                "misc_losses": 4,
                "gain": 4,
                "losses": 4,
                "ue_height": 1.5,
                "indoor": True,
            }
        },
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544712.9242233046, 259378.04413438193]
            },
            'properties': {
                "ue_id": "AB2",
                "sitengr": 'TL4454059600',
                "misc_losses": 4,
                "gain": 4,
                "losses": 4,
                "ue_height": 1.5,
                "indoor": True,
            }
        }
        ]


@fixture(scope='function')
def setup_single_receiver():
    return [
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544809.5557435964, 259520.0001617251]
            },
            'properties': {
                "ue_id": "AB3",
                "sitengr": 'TL4454059600',
                "misc_losses": 4,
                "gain": 4,
                "losses": 4,
                "ue_height": 1.5,
                "indoor": True,
            }
        },
        ]


@pytest.fixture
def setup_simulation_parameters():
    return {
    'iterations': 100,
    'seed_value': 42,
    'tx_baseline_height': 30,
    'tx_upper_height': 40,
    'tx_power': 40,
    'tx_gain': 16,
    'tx_losses': 1,
    'rx_gain': 4,
    'rx_losses': 4,
    'rx_misc_losses': 4,
    'rx_height': 1.5,
    'network_load': 50,
    'percentile': 95,
    'desired_transmitter_density': 10,
    'sectorisation': 3,
    }


@pytest.fixture
def base_system(setup_cb41_postcode_sector, setup_site_areas, setup_simulation_parameters,
    setup_transmitters, setup_receivers):

    geojson_postcode_sector = setup_cb41_postcode_sector

    geojson_postcode_sector['properties']['local_authority_ids'] = [
        'E07000008'
        ]

    system = SimulationManager(geojson_postcode_sector, setup_transmitters, setup_site_areas,
        setup_receivers, setup_simulation_parameters)

    return system


@pytest.fixture
def postcode_sector_lut():

    yield {
        'postcode_sector': 'CB11',
        'indoor_probability': 100,
        'outdoor_probability': 0,
        'residential_count': 20,
        'non_residential_count': 20,
        'estimated_population': 50,
        'area': 200,
        'pop_density_km2': 0.25,
    }


# transmitter_areas = []
# for site in areas:
#     point_geom = shape(site['geometry'])
#     buffer = point_geom.buffer(10)
#     transmitter_areas.append({
#         'type': site['type'],
#         'geometry': mapping(site),
#         'properties': {
#             'sitengr': site['sitengr'],
#             'pcd_sector': site['pcd_sector']
#         }
#     })
# import pprint
# pprint.pprint(transmitter_areas)


@fixture(scope='function')
def setup_site_areas():
    return [
            {'geometry': {'coordinates': (((544575.1049227581, 259475.22477912105),
                                        (544735.1049227581, 259475.22477912105),
                                        (544735.1049227581, 259635.22477912105),
                                        (544575.1049227581, 259635.22477912105),
                                        (544575.1049227581, 259475.22477912105)),),
            'type': 'Polygon'},
            'properties': {'pcd_sector': 'CB1 2', 'sitengr': 'TL4454059600'},
            'type': 'Feature'},
            {'geometry': {'coordinates': (((545185.1768673284, 259575.21841664566),
                                            (545345.1768673284, 259575.21841664566),
                                            (545345.1768673284, 259735.21841664566),
                                            (545185.1768673284, 259735.21841664566),
                                            (545185.1768673284, 259575.21841664566)),),
                        'type': 'Polygon'},
            'properties': {'pcd_sector': 'CB1 1', 'sitengr': 'TL4515059700'},
            'type': 'Feature'},
            {'geometry': {'coordinates': (((545205.5165949427, 259403.84577720467),
                                            (545365.5165949427, 259403.84577720467),
                                            (545365.5165949427, 259563.84577720467),
                                            (545205.5165949427, 259563.84577720467),
                                            (545205.5165949427, 259403.84577720467)),),
                        'type': 'Polygon'},
            'properties': {'pcd_sector': 'CB1 2', 'sitengr': 'TL4529059480'},
            'type': 'Feature'},
            {'geometry': {'coordinates': (((545805.2027838879, 259515.2986071491),
                                            (545965.2027838879, 259515.2986071491),
                                            (545965.2027838879, 259675.2986071491),
                                            (545805.2027838879, 259675.2986071491),
                                            (545805.2027838879, 259515.2986071491)),),
                        'type': 'Polygon'},
            'properties': {'pcd_sector': 'CB1 2', 'sitengr': 'TL4577059640'},
            'type': 'Feature'}]

@pytest.fixture
def system_single_receiver(setup_cb41_postcode_sector, setup_simulation_parameters,
    setup_transmitters, setup_site_areas, setup_single_receiver):

    geojson_postcode_sector = setup_cb41_postcode_sector

    geojson_postcode_sector['properties']['local_authority_ids'] = [
        'E07000008'
        ]

    system = SimulationManager(geojson_postcode_sector, setup_transmitters,
        setup_site_areas, setup_single_receiver, setup_simulation_parameters)

    return system


@pytest.fixture
def setup_build_new_transmitter():
    return [
        {
            'type': "Feature",
            'geometry': {
                "type": "Point",
                "coordinates": [544766, 259988]
            },
            'properties': {
                    "operator": 'unknown',
                    "sitengr": '{new}{GEN1}',
                    "ant_height": 20,
                    "tech": 'LTE',
                    "freq": 700,
                    "type": 17,
                    "power": 30,
                    "gain": 16,
                    "losses": 1,
                }
        }
    ]

@pytest.fixture
def setup_new_site_area():
    return [
        {
            'type': 'Feature',
            'geometry': {
                'type': 'Polygon',
                'coordinates': (((544686.0, 259908.0),
                                (544846.0, 259908.0),
                                (544846.0, 260068.0),
                                (544686.0, 260068.0),
                                (544686.0, 259908.0)),),
            },
            'properties': {
                'sitengr': '{new}{GEN1}',
                },
        }
        ]
